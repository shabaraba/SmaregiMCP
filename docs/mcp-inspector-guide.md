# MCP Inspector ガイド

MCP Inspectorは、ModelContextProtocol (MCP) サーバーとの対話をデバッグするためのツールです。このガイドでは、スマレジMCPプロジェクトでの使用方法について説明します。

## インストール

MCP Inspectorはすでにプロジェクトの開発依存関係としてインストールされています。

```bash
# package.jsonで確認できます
npm list @modelcontextprotocol/inspector
```

## 使用方法

### インスペクターの起動

MCP Inspectorを起動するには、以下のコマンドを実行します：

```bash
npm run mcp:inspect
```

これにより、ブラウザが自動的に開き、http://localhost:6274 でインスペクターのUIが表示されます。

### MCPサーバーへの接続

1. 「Connect」ボタンをクリックして、MCPサーバーに接続します。
2. 接続が成功すると、利用可能なツール、プロンプト、リソースが表示されます。

### リソースの調査

インスペクターUIの「Resources」タブでは、MCPサーバーが提供するリソースを確認できます。スマレジMCPは以下のリソースを提供します：

- `smaregi://api/{category}/{path}` - スマレジAPIリソース
- `smaregi://docs/{document}` - スマレジAPIドキュメント

### ツールの調査と実行

「Tools」タブでは、MCPサーバーが提供するツールを確認し、実行できます。スマレジMCPの主要なツールは以下の通りです：

- 認証ツール - OAuth認証プロセスを管理するためのツール
- APIリクエストツール - スマレジAPIへのリクエストを実行するためのツール
- 生成されたAPIツール - 各スマレジAPIエンドポイント用に生成されたツール

### プロンプトの調査

「Prompts」タブでは、事前定義されたプロンプトを確認できます。これには、商品検索、売上分析などのプロンプトが含まれます。

## トラブルシューティング

### 接続エラー

MCPサーバーへの接続時にエラーが発生した場合は、以下を確認してください：

1. MCPサーバーが実行中であること
2. プロキシサーバーが実行中であること（ポート6277）
3. `.env`ファイルの設定が正しいこと

### データベースエラー

データベース関連のエラーが発生した場合は、以下を確認してください：

1. `DATABASE_PATH`環境変数が正しく設定されていること
2. 指定されたディレクトリが存在し、書き込み権限があること

### ESモジュールの互換性エラー

ESモジュールの互換性エラーが発生した場合は、以下を確認してください：

1. Node.jsのバージョンが適切であること（v16以上を推奨）
2. `package.json`の`"type": "module"`が設定されていること
3. すべての依存関係がESモジュール形式と互換性があること

## デバッグのベストプラクティス

1. コンソールログを確認する - MCPサーバーはstderrにログを出力します
2. 接続前に環境変数を確認する - `.env`ファイルの設定が正しいことを確認します
3. 一度に1つのリクエストをテストする - 複雑なシナリオは個別のステップに分解してテストします

## 参考リンク

- [MCP Inspector公式ドキュメント](https://modelcontextprotocol.io/docs/tools/inspector)
- [MCP SDK ドキュメント](https://modelcontextprotocol.io/docs/sdk)
- [MCP デバッグガイド](https://modelcontextprotocol.io/docs/tools/debugging)
