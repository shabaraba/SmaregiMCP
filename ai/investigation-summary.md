# SQLiteログが標準出力に出力されMCPプロトコルと競合する問題の調査・修正

## 問題の概要

SQLiteのログが標準出力に出力され、MCPプロトコルのJSON通信と競合している問題が発生していました。MCPプロトコルはJSON形式のメッセージを標準出力/入力経由でやり取りするため、SQLiteのログ出力がJSON形式の通信を破壊し、エラーとなっていました。

## 原因

1. TypeORMのデフォルト設定では、SQLiteのクエリログが標準出力（stdout）に出力される
2. MCPプロトコルはJSON形式のメッセージを標準出力/入力経由で通信する
3. StdioServerTransportクラスは標準入出力を使ってメッセージをやり取りしている
4. その結果、SQLiteログ（非JSON形式）とMCPメッセージ（JSON形式）が混在して、通信エラーとなる

## 修正方法

TypeORMのカスタムロガー（`TypeOrmCustomLogger`）を実装し、すべてのSQLiteログを標準エラー出力（stderr）に転送するようにしました。具体的には：

1. `TypeOrmCustomLogger`クラスを実装し、TypeORMのLoggerインターフェースを実装
2. このロガーは全てのログメッセージを標準エラー出力（stderr）に出力する
3. app.module.tsで、TypeORMの設定にこのカスタムロガーを指定

## 実装の詳細

1. `src/database/typeorm-custom-logger.ts`に、TypeORMのLoggerインターフェースを実装したカスタムロガーを作成
2. app.module.tsのTypeORM設定を更新して、このカスタムロガーを使用するように変更
3. 標準出力ではなく標準エラー出力を使うようにコードを修正（`console.log` => `process.stderr.write`）

## 期待される効果

1. SQLiteのログが標準エラー出力に出力されるため、MCPプロトコルのJSON通信と競合しない
2. MCPプロトコルの通信エラーが解消される
3. 開発時にはSQLiteのログを確認できる（標準エラー出力で）
4. 本番環境では最小限のロギングに設定可能

## テスト方法

1. カスタムロガーが標準エラー出力にログを出力することを確認
2. MCPプロトコルの通信が正常に行われることを確認
3. 開発環境でSQLiteのデバッグ情報が確認できることを確認

## 追加の改善点

1. 環境変数によってログのレベルを変更可能に
2. ログの保存先をファイルに設定するオプションの追加
3. TypeORMのデバッグモードをより細かく制御するオプションの追加
